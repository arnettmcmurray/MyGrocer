<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>MyGrocer — Recipes</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="/js/config.js"></script>
    <script defer src="/js/api.js"></script>

    <script
      defer
      src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
  </head>

  <body class="bg-gradient-to-b from-gray-900 to-gray-800 text-gray-100">
    <main
      class="max-w-4xl mx-auto mt-10 p-6 bg-gray-800 rounded-xl shadow-lg"
      x-data="recipesPage()"
    >
      <h2 class="text-2xl font-semibold mb-6 text-green-400">
        Recipe Suggestions
      </h2>

      <button
        @click="fromPantry()"
        :disabled="loading"
        class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded text-white"
      >
        Suggest Recipes From My Pantry
      </button>

      <div class="text-red-400 mt-4" x-show="error" x-text="error"></div>
      <p x-show="loading" class="mt-4">Loading…</p>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
        <template x-for="r in results">
          <article class="bg-gray-700 p-4 rounded-lg shadow">
            <img :src="r.image" class="w-full rounded mb-3" />

            <strong class="text-lg" x-text="r.title"></strong>

            <p class="mt-2 text-sm text-gray-300">
              Uses:
              <span
                class="font-semibold"
                x-text="r.usedIngredients.map(i => i.name).join(', ') || 'none'"
              ></span>
              <br />
              Missing:
              <span
                class="font-semibold"
                x-text="r.missedIngredients.map(i => i.name).join(', ') || 'none'"
              ></span>
            </p>

            <a
              :href="`https://spoonacular.com/recipes/${r.title.replace(/ /g,'-')}-${r.id}`"
              target="_blank"
              class="text-blue-400 hover:underline mt-3 inline-block"
            >
              View Recipe
            </a>
          </article>
        </template>
      </div>

      <nav class="mt-8 space-x-6 text-sm text-gray-400">
        <a href="/index.html" class="hover:underline">Home</a>
        <a href="/pantry.html" class="hover:underline">Pantry</a>
      </nav>
    </main>

    <script>
      function recipesPage() {
        return {
          loading: false,
          error: "",
          results: [],

          async fromPantry() {
            this.loading = true;
            this.error = "";
            this.results = [];

            try {
              const pantry = await window.API.pantryList();
              const names = pantry.map((p) => p.name);

              if (names.length === 0) {
                this.error = "Your pantry is empty.";
                this.loading = false;
                return;
              }

              const recipes = await window.API.recipesByIngredients(names);
              this.results = recipes;
            } catch (err) {
              this.error = err.message || "Error fetching recipes.";
            } finally {
              this.loading = false;
            }
          },
        };
      }
    </script>
  </body>
</html>
